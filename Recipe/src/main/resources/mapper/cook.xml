<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cook">

	<resultMap id="CookResultMap" type="kr.ac.kopo.recipe.model.Cook">
		<id property="recipeid" column="recipeid" />
		<result property="recipetitle" column="recipetitle" />
		<result property="comment" column="comment" />
		<result property="link" column="link" />
		<result property="userid" column="userid" />
		<result property="mainimagepath" column="mainimagepath" />
		<result property="recommend" column="recommend" />
	</resultMap>

	<select id="list" resultType="Cook">
		SELECT *
		FROM cook
	</select>

	<insert id="addCook" parameterType="Cook">
		<selectKey keyProperty="recipeid" resultType="int" order="BEFORE">
			SELECT cook_seq.nextval FROM dual
		</selectKey>
		INSERT INTO cook(recipeid, recipetitle, "comment", link, userid, mainimagepath)
		VALUES (#{recipeid}, #{recipetitle}, #{comment}, #{link}, #{userid}, #{mainimagepath})
	</insert>

	<insert id="addStep" parameterType="Step">
		INSERT INTO step(recipeid, step_order, content, ingredient, tools, tip, imagepath)
		VALUES (#{recipeid}, #{stepOrder}, #{content}, #{ingredient}, #{tools}, #{tip}, #{imagepath})
	</insert>

	<select id="item" resultType="Cook">
		SELECT *
		FROM cook
		WHERE recipeid = #{recipeid}
	</select>
	
	<select id="stepItem" resultType="Step">
		SELECT *
		FROM step
		WHERE recipeid = #{recipeid}
	</select>

	<update id="update" parameterType="Cook">
		UPDATE cook
		SET recipetitle = #{recipetitle},
		"comment" = #{comment},
		link = #{link},
		mainimagepath = #{mainimagepath}
		WHERE recipeid = #{recipeid}
	</update>
		
	<update id="stepUpdate" parameterType="Step">
		UPDATE step
		SET content= #{content},
		ingredient = #{ingredient},
		tools = #{tools},
		tip = #{tip},
		imagepath = #{imagepath}
		WHERE recipeid = #{recipeid}
	</update>
	
	<delete id="delete" parameterType="int">
		DELETE FROM cook
		WHERE recipeid = #{recipeid}
	</delete>

	<delete id="stepDelete" parameterType="int">
		DELETE FROM step
		WHERE recipeid = #{recipeid}
	</delete>

	<select id="detail" resultType="Cook">
		SELECT *
		FROM cook
		WHERE recipeid = #{recipeid}
	</select>

	<select id="getStepsByRecipeid" resultType="Step">
		SELECT * FROM step
		WHERE recipeid = #{recipeid}
		ORDER BY step_order
	</select>
	
	<select id="getRecommended" resultType="Cook">
		SELECT *
		FROM cook
		WHERE recommend = '1'
	</select>
	
	<insert id="recommend" parameterType="map">
	    <selectKey keyProperty="recommendnum" resultType="int" order="BEFORE">
	        SELECT recommend_seq.NEXTVAL FROM dual
	    </selectKey>
	    INSERT INTO recommend (recommendnum, userid, writedate)
	    VALUES (#{recommendnum}, #{userid}, #{writedate})
	</insert>

</mapper>